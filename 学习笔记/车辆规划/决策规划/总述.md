#  决策规划问题引入

作为一个顶层模块，对所获得的信息进行汇总，做出合适的决策，来指导车辆的运动规划和控制 

![image-20240201162019848](../../imgs/image-20240201162019848.png)

- 输入：定位、感知、地图、全局路径（静态）

  ![image-20240201162305162](../../imgs/image-20240201162305162.png)

- 输出：无人车具体的行为决策，如行车、停车、紧急制动、倒车、减速慢行、变道等。下游是给到动作规划，局部规划 



- 决策涉及准则
  - 合理性：建立在两个基础之上——交通法规和驾驶经验，其中交通法规的优先级又要高于驾驶经验，交通法规需要考虑的内容包括：靠右侧车道行驶，不能超速，换到超车时应提前开启转向灯，对于感知到的交通信号灯和交通标志，应按照其只是内容行驶，出现任何危险情况，应当能够果断地执行紧急制动等等。驾驶经验需要考虑的内容主要包括：尽量保持在原车道，不应随意变道；城市路段行驶时，不应随意加速，确保驾驶的平顺性；对于前车行驶缓慢而条件运行的情况应当果断超车等等。
  - 实时性：任何无人车系统中的行为规划都是实时的，行为规划应当能够处理复杂的动态交通场景，并且能够根据环境的变化快速的调整驾驶行为以避免危险的发生。



- 如何实施行为决策

  - 限制规划的搜索空间，例如将搜索空间限制在停车区域内
  - 如果是目标类型的场景，可以设置目标终点，例如变道的时候将终点放到目标车道上
  - 设置轨迹的约束，例如需要停车时，速度设置为0
  - 代价函数的约束
  - 设置虚拟障碍物



- 对规划完备性的影响

  限制了条件以后，那么可以规划的区域相应的会减少，影响了规划器的完备性



- 什么是一个好的决策器
  - 实时性
  - 考虑动作的影响
  - 考虑其他交通参与者的影响
  - 可靠和可重复性



- 行为决策中的挑战
  - 决策密度：需要考虑参与者数量大，计算量很大；需要考虑实时性，频率在10-30HZ左右（每30-100ms计算一次）
  - 不确定性
    - 运动不确定性
    - 遮挡不确定性
    - 运动模型的不确定性



- 不确定性的来源

  - 定位：有可能会偏差或者漂移从而产生误差
  - 控制：跟踪误差
  - 感知：当前世界状态，其他车的位置、大小、速度、类型、交通灯状态
  - 可见性限制：环境状态是否都可见

  

# 常见方法

- 基于规则的方法：有限状态机、行为树等，特点如下
  - 逻辑清晰

  - 可解释性强
  - 容易建模和执行
  - 处理器要求不高
  - 可调整性强
  - 行为连贯性不强
  - 行为规则的触发条件容易重叠，失效
  - 有限状态机可能不能cover所有场景
  - 长尾效应，会忽略一些情况

- 基于机器学习的方法：强化学习、深度强化学习、决策树等，特点如下
  - 场景的状态空间丰富，易于覆盖工况
  - 场景决策模型可以被CNN简化
  - 一些算法和模型可以自学习
  - 可解释性差
  - 很难调整模型
  - 不同场景会训练出不同模型
  - 需要采样大量的实验数据
  - 表现好坏非常依赖于数据质量


